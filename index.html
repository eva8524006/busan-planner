<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Busan Trip</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans TC', 'Inter', sans-serif; background-color: #f8fafc; margin: 0; padding: 0; touch-action: pan-y; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .header-banner { width: 100%; height: 350px; background-image: url('image_ac77bf.jpg'); background-size: cover; background-position: center; position: relative; }
        .header-overlay { position: absolute; inset: 0; background: linear-gradient(to top, rgba(248,250,252,1) 0%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.4) 100%); }
        .main-content { margin-top: -60px; border-radius: 40px 40px 0 0; background: #f8fafc; min-height: 80vh; padding: 24px; position: relative; }
        .title-group { position: absolute; bottom: 140px; right: 24px; text-align: right; z-index: 10; }
        .nav-container { position: absolute; bottom: 80px; right: 24px; display: flex; gap: 8px; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); padding: 6px; border-radius: 22px; z-index: 30; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .tab-btn { transition: all 0.3s; display: flex; align-items: center; justify-content: center; width: 44px; height: 44px; border-radius: 16px; }
        .tab-btn.active { background-color: #3b82f6; color: white; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); }
        .date-item.active { background: #3b82f6; color: white; border-color: #3b82f6; transform: scale(1.05); }
        .time-tag { background: #eff6ff; color: #3b82f6; padding: 2px 8px; border-radius: 8px; font-family: 'Inter', monospace; font-weight: 700; font-size: 11px; }
        .cost-card { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); }
    </style>
</head>
<body>
    <div id="app" class="max-w-md mx-auto relative min-h-screen">
        
        <div class="fixed top-4 left-4 z-50">
            <button @click="exportData" class="bg-black/60 text-white text-[10px] px-4 py-2 rounded-full backdrop-blur-md border border-white/20">
                <i data-lucide="share-2" class="w-3 h-3 inline mr-1"></i> ÂêåÊ≠•Ë≥áÊñô
            </button>
        </div>

        <header class="header-banner">
            <div class="header-overlay"></div>
            <div class="title-group">
                <p class="text-[10px] font-bold text-blue-500 tracking-[0.3em] uppercase mb-0">Spring 2026</p>
                <h1 class="text-3xl font-black text-slate-800 uppercase tracking-tighter">Busan Trip</h1>
            </div>
            
            <div class="nav-container">
                <button @click="currentTab = 'itinerary'" :class="['tab-btn', currentTab==='itinerary'?'active':'text-gray-400']"><i data-lucide="calendar"></i></button>
                <button @click="currentTab = 'info'" :class="['tab-btn', currentTab==='info'?'active':'text-gray-400']"><i data-lucide="info"></i></button>
                <button @click="currentTab = 'shop'" :class="['tab-btn', currentTab==='shop'?'active':'text-gray-400']"><i data-lucide="shopping-bag"></i></button>
                <button @click="currentTab = 'cost'" :class="['tab-btn', currentTab==='cost'?'active':'text-gray-400']"><i data-lucide="wallet"></i></button>
            </div>
        </header>

        <main class="main-content pb-32">
            <div v-show="currentTab === 'itinerary'">
                <div class="flex overflow-x-auto gap-3 no-scrollbar mb-8 py-2">
                    <div v-for="d in dates" :key="d.id" @click="selectedDate = d.id" :class="['date-item flex-shrink-0 w-16 h-20 rounded-[2rem] border flex flex-col items-center justify-center cursor-pointer transition-all', selectedDate === d.id ? 'active' : 'bg-white text-gray-400 border-gray-100']">
                        <span class="text-[10px] font-bold uppercase mb-1">{{ d.week }}</span>
                        <span class="text-xl font-black font-mono">{{ d.day }}</span>
                    </div>
                </div>
                <div class="space-y-4">
                    <div v-for="item in sortedItinerary" :key="item.id" class="bg-white p-5 rounded-[2rem] border border-gray-50 shadow-sm flex gap-4 items-center">
                        <div class="p-4 rounded-2xl bg-blue-50 text-blue-500"><i :data-lucide="item.icon || 'map-pin'" class="w-5 h-5"></i></div>
                        <div class="flex-1" @click="openEditModal(item)">
                            <div class="flex justify-between items-start">
                                <div class="flex-1 pr-2">
                                    <span v-if="item.time" class="time-tag mb-1.5 inline-block">{{ item.time }}</span>
                                    <h3 class="font-bold text-gray-800 text-base leading-tight">{{ item.name }}</h3>
                                    <p v-if="item.note" class="text-[10px] text-gray-400 mt-1">{{ item.note }}</p>
                                </div>
                                <div class="flex gap-1">
                                    <button v-if="item.location" @click.stop="openMap(item.location)" class="text-blue-500 bg-blue-50 p-2.5 rounded-full"><i data-lucide="map" class="w-4 h-4"></i></button>
                                    <button @click.stop="deleteItem('itinerary', item.id)" class="text-gray-300 p-2.5"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'info'" class="space-y-6">
                <div class="bg-white p-6 rounded-[2.5rem] border border-gray-100 shadow-sm">
                    <h3 class="font-bold text-gray-800 flex items-center gap-2 mb-4">
                        <i data-lucide="bed-double" class="w-5 h-5 text-blue-500"></i> Hotel
                    </h3>
                    <div class="p-4 bg-slate-50 rounded-3xl mb-4">
                        <p class="text-xl font-black text-gray-800">Stanford Busan Hotel</p>
                        <p class="text-xs text-gray-400 mt-1 flex items-center gap-1">
                            <i data-lucide="map-pin" class="w-3 h-3"></i> Nampo-dong, Busan
                        </p>
                    </div>
                </div>
                <div class="bg-slate-800 p-6 rounded-[2.5rem] text-white shadow-xl">
                    <p class="text-[10px] text-blue-400 font-bold uppercase mb-4 tracking-widest">Flight Information</p>
                    <div class="flex justify-between items-center text-center">
                        <div><p class="text-lg font-black">TPE</p><p class="text-[10px] opacity-50">4/10 02:50</p></div>
                        <i data-lucide="move-right" class="text-blue-400"></i>
                        <div><p class="text-lg font-black">PUS</p><p class="text-[10px] opacity-50">4/10 06:10</p></div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'shop'" class="space-y-4">
                <div class="flex justify-between items-end mb-4">
                    <h2 class="font-black text-3xl text-gray-800">Shopping</h2>
                    <span class="text-xs font-bold text-blue-500 bg-blue-50 px-3 py-1 rounded-full">{{ db.shop.filter(s => s.done).length }}/{{ db.shop.length }}</span>
                </div>
                <div v-for="item in db.shop" :key="item.id" class="flex items-center gap-4 bg-white p-5 rounded-3xl border border-gray-100" :class="{'opacity-60': item.done}">
                    <input type="checkbox" v-model="item.done" @change="saveData" class="w-6 h-6 rounded-full border-2 border-blue-500 text-blue-500">
                    <p :class="{'line-through': item.done}" class="flex-1 font-bold text-gray-700">{{ item.name }}</p>
                    <button @click="deleteItem('shop', item.id)" class="text-gray-200"><i data-lucide="x" class="w-5 h-5"></i></button>
                </div>
            </div>

            <div v-if="currentTab === 'cost'" class="space-y-6">
                <div class="cost-card p-10 rounded-[3rem] text-white shadow-2xl relative overflow-hidden">
                    <p class="text-[10px] opacity-50 font-bold uppercase tracking-[0.3em] mb-2 text-blue-400">Total Expenses</p>
                    <p class="text-3xl font-black mb-1">‚Ç© {{ totals.krw.toLocaleString() }}</p>
                    <p class="text-lg font-bold text-gray-400">‚âà TWD {{ totals.twd.toLocaleString() }}</p>
                    <i data-lucide="banknote" class="absolute -bottom-4 -right-4 w-32 h-32 opacity-10"></i>
                </div>

                <div class="flex justify-between items-center px-4">
                    <p class="text-[10px] text-gray-400 font-bold">1 TWD = {{ exchangeRate }} KRW</p>
                    <button @click="fetchRate" class="text-[10px] bg-white border px-3 py-1 rounded-full text-blue-500 font-bold">Êõ¥Êñ∞ÂåØÁéá</button>
                </div>

                <div class="space-y-3">
                    <div v-for="item in db.cost" :key="item.id" class="bg-white p-5 rounded-3xl border border-gray-50 flex justify-between items-center">
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-800">{{ item.name }}</h4>
                            <p class="text-[10px] text-gray-400 uppercase font-bold">{{ item.currency }}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-black text-gray-800">{{ item.currency === 'KRW' ? '‚Ç©' : '$' }} {{ item.amount.toLocaleString() }}</p>
                            <p class="text-[10px] text-gray-400">‚âà {{ item.currency === 'KRW' ? '$' + Math.round(item.amount / exchangeRate) : '‚Ç©' + Math.round(item.amount * exchangeRate) }}</p>
                        </div>
                        <button @click="deleteItem('cost', item.id)" class="ml-4 text-gray-200"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                    </div>
                </div>
            </div>
        </main>

        <button @click="openAddModal" class="fixed bottom-8 right-8 w-16 h-16 bg-blue-500 text-white rounded-full shadow-2xl flex items-center justify-center z-40 border-4 border-white">
            <i data-lucide="plus" class="w-8 h-8"></i>
        </button>

        <div v-if="showModal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-md flex items-end justify-center">
            <div class="bg-white w-full max-w-md rounded-t-[3.5rem] p-10 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-8">
                    <h3 class="text-2xl font-black text-gray-800">Á∑®ËºØÈ†ÖÁõÆ</h3>
                    <button @click="showModal = false" class="bg-gray-100 p-2 rounded-full text-gray-400"><i data-lucide="x"></i></button>
                </div>
                
                <div v-if="currentTab === 'itinerary'" class="space-y-6">
                    <input v-model="form.name" type="text" placeholder="ÂêçÁ®±" class="w-full border-b-2 py-3 outline-none font-bold text-xl">
                    <input v-model="form.location" type="text" placeholder="Âú∞ÂúñÈÄ£Áµê" class="w-full border-b-2 py-3 outline-none text-blue-600">
                    <div class="flex gap-6">
                        <div class="flex-1"><label class="text-[10px] text-gray-400 uppercase">ÊôÇÈñì</label><input v-model="form.time" type="time" class="w-full border-b-2 py-3 outline-none font-bold"></div>
                        <div class="flex-1">
                            <label class="text-[10px] text-gray-400 uppercase">ÂúñÊ®ô</label>
                            <select v-model="form.icon" class="w-full border-b-2 py-3 outline-none bg-transparent">
                                <option value="map-pin">ÊôØÈªû</option><option value="utensils">È§êÈ£≤</option><option value="shopping-cart">Ë≥ºÁâ©</option><option value="coffee">ÂíñÂï°</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div v-if="currentTab === 'cost'" class="space-y-6">
                    <input v-model="form.name" type="text" placeholder="ÊîØÂá∫È†ÖÁõÆ" class="w-full border-b-2 py-3 outline-none font-bold text-xl">
                    <div class="flex gap-4 items-end">
                        <div class="flex-1"><label class="text-[10px] text-gray-400 uppercase">ÈáëÈ°ç</label><input v-model.number="form.amount" type="number" class="w-full border-b-2 py-3 outline-none font-bold text-2xl"></div>
                        <select v-model="form.currency" class="border-b-2 py-3 outline-none font-bold text-blue-500">
                            <option value="KRW">KRW</option><option value="TWD">TWD</option>
                        </select>
                    </div>
                </div>

                <button @click="handleSave" class="w-full bg-blue-500 text-white py-5 rounded-[2rem] mt-10 font-black shadow-lg">ÂÑ≤Â≠òÈ†ÖÁõÆ</button>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch, nextTick } = Vue;

        createApp({
            setup() {
                const DB_KEY = 'busan_vFinal_2026_Full_Sync';
                const currentTab = ref('itinerary');
                const selectedDate = ref('4/10');
                const showModal = ref(false);
                const isEditing = ref(false);
                const editingId = ref(null);
                const exchangeRate = ref(42);
                const form = ref({ name: '', location: '', icon: 'map-pin', time: '', amount: 0, currency: 'KRW', note: '' });

                // ÈÄôË£°ÊúÉÊäìÂèñ‰Ω†Êèê‰æõÁöÑÊúÄÊñ∞ JSON Ë≥áÊñô
                const initialData = {
                    "itinerary": [
                        { "id": 101, "date": "4/10", "time": "02:50", "name": "Ê°ÉÂúíÊ©üÂ†¥ (ÂéªÁ®ã)", "icon": "plane", "location": "TPE" },
                        { "id": 102, "date": "4/10", "time": "06:10", "name": "ÈáúÂ±±Ê©üÂ†¥", "icon": "map-pin", "location": "PUS" },
                        { "id": 103, "date": "4/10", "time": "09:00", "name": "ÎèôÏÇºÌï¥ÏàòÏ≤úÔºàÂΩ±Â≥∂Ë≥ûÊ´ª üå∏Ôºâ", "icon": "sparkles", "location": "https://maps.app.goo.gl/roJYgNsJ1EbKKoLd6?g_st=ic" },
                        { "id": 1771424814143, "date": "4/10", "time": "07:00", "name": "ÊøüÂ∑ûÂÆ∂", "icon": "utensils", "location": "https://naver.me/GtYmzjVh" },
                        { "id": 104, "date": "4/10", "time": "12:00", "name": "ËûûËüªÂÆ∂Ëæ£ÁÇíÁ´†È≠ö ÂçóÊµ¶Ê¥û", "icon": "utensils", "location": "https://maps.app.goo.gl/nGTpxmNqcgeQ1ARf9?g_st=ic" },
                        { "id": 105, "date": "4/10", "time": "13:00", "name": "Olive Young", "icon": "shopping-cart", "location": "Olive Young" },
                        { "id": 106, "date": "4/10", "time": "14:00", "name": "Íµ≠Ï†úÏïΩÍµ≠ (Gukje PharmacyÂúãÈöõËó•Â±Ä)", "icon": "shopping-cart", "location": "https://maps.app.goo.gl/vYkZ1uj2j4b2Nj2M7?g_st=ic" },
                        { "id": 107, "date": "4/10", "time": "17:00", "name": "ÂçóÊµ¶Ê¥ûÈÄõË°ó", "icon": "shopping-cart", "location": "https://maps.app.goo.gl/XkWm6WHjm3bqPacs9" },
                        { "id": 108, "date": "4/10", "time": "19:00", "name": "Ê®ÇÂ§©Ë∂ÖÂ∏Ç", "icon": "shopping-cart", "location": "https://maps.app.goo.gl/6BwX9Hf6mF3R748H8" },
                        { "id": 1771424871843, "date": "4/11", "time": "09:00", "name": "Egg drop", "icon": "utensils", "location": "https://naver.me/FetHsTwc" },
                        { "id": 201, "date": "4/11", "time": "11:00", "name": "Êµ∑Èõ≤Âè∞ Busan Bada Sand", "icon": "shopping-cart", "location": "https://maps.app.goo.gl/YtBT6VxaHffRkv4B7" },
                        { "id": 202, "date": "4/11", "time": "11:10", "name": "Delight project Ë≤ùÊûúÂ∫ó", "icon": "shopping-cart", "location": "https://naver.me/GdTEaA1g" },
                        { "id": 203, "date": "4/11", "time": "11:30", "name": "Êµ∑Èõ≤Âè∞ÂêçÂìÅÁ≥ñÈ§Ö", "icon": "utensils", "location": "https://naver.me/FmG8sKRg" },
                        { "id": 204, "date": "4/11", "time": "13:00", "name": "Keveren House Áë™Ë≤ªËõãÁ≥ï", "icon": "coffee", "location": "https://naver.me/FgEema7r" },
                        { "id": 205, "date": "4/11", "time": "12:00", "name": "Ê∞¥ÈÇäÊúÄÈ´òË±¨ËÇâÊπØÈ£Ø", "icon": "utensils", "location": "ÏàòÎ≥ÄÏµúÍ≥†ÎèºÏßÄÍµ≠Î∞•" },
                        { "id": 206, "date": "4/11", "time": "13:00", "name": "Êñ∞‰∏ñÁïåÁôæË≤® Centum CityÂ∫ó", "icon": "shopping-cart", "location": "https://naver.me/GvX8pY1z" },
                        { "id": 207, "date": "4/11", "time": "15:00", "name": "ËóçÁì∂ÂíñÂï° ÈáúÂ±±Ê∞ëÊ®ÇÂ∫ó", "icon": "coffee", "location": "https://naver.me/xw2Q9WwG" },
                        { "id": 208, "date": "4/11", "time": "16:00", "name": "Ë•øÈù¢ÈÄõË°ó", "icon": "shopping-cart", "location": "Ë•øÈù¢" },
                        { "id": 209, "date": "4/11", "time": "17:00", "name": "Í≥†ÌïòÏàú ÁÉ§ËÇâÂ∫ó", "icon": "utensils", "location": "https://naver.me/GSQwnZgY" },
                        { "id": 210, "date": "4/11", "time": "18:00", "name": "PuffÈ∫µÂåÖÂ∫ó", "icon": "map-pin", "location": "https://naver.me/xiLnU6Iq" },
                        { "id": 302, "date": "4/12", "time": "08:00", "name": "ÂØåÂπ≥ÁΩêÈ†≠Â∏ÇÂ†¥", "icon": "shopping-cart", "location": "https://naver.me/5X9z6R2p" },
                        { "id": 303, "date": "4/12", "time": "10:00", "name": "ÂúãÈöõÂ∏ÇÂ†¥", "icon": "shopping-cart", "location": "https://naver.me/50BH81TU" },
                        { "id": 304, "date": "4/12", "time": "12:00", "name": "Â±±Ëéä1988 Ë•øÈù¢Êú¨Â∫ó È¶¨Èà¥ËñØÂ∫ó", "icon": "utensils", "location": "https://naver.me/5ulXyugg" },
                        { "id": 305, "date": "4/12", "time": "13:00", "name": "All Sunday Ë≤ùÊûúÂª£ÂÆâÈáå", "icon": "utensils", "location": "https://naver.me/FriDJCJv" },
                        { "id": 306, "date": "4/12", "time": "20:45", "name": "ÈáúÂ±±ÈáëÊµ∑Ê©üÂ†¥", "icon": "map-pin", "location": "PUS", "note": "ÂõûÁ®ã" }
                    ],
                    "shop": [
                        { "id": 501, "name": "ÂåóËáâ (The North Face)", "done": false },
                        { "id": 502, "name": "Busan butter sand", "done": false },
                        { "id": 503, "name": "ËúÇËúú‰∫∫ËîòÁâá", "done": false },
                        { "id": 504, "name": "ÈòøÁè†Â™ΩËÉåÂøÉ", "done": false },
                        { "id": 505, "name": "Loe È¶ôÊ∞¥", "done": false },
                        { "id": 506, "name": "Object ÁüÆË¢ãÈº†", "done": false },
                        { "id": 507, "name": "Ê®ÇÂ§©Ë∂ÖÂ∏Ç", "done": false },
                        { "id": 508, "name": "‰∫å‰ª£ÂêçÊûú", "done": false }
                    ],
                    "cost": []
                };

                const db = ref(JSON.parse(localStorage.getItem(DB_KEY)) || initialData);

                const fetchRate = async () => {
                    try {
                        const res = await fetch('https://open.er-api.com/v6/latest/TWD');
                        const data = await res.json();
                        if (data.rates && data.rates.KRW) exchangeRate.value = parseFloat(data.rates.KRW.toFixed(2));
                    } catch (e) { console.error("Rate fail"); }
                };

                const totals = computed(() => {
                    let krw = 0, twd = 0;
                    db.value.cost.forEach(i => {
                        if (i.currency === 'KRW') { krw += i.amount; twd += i.amount / exchangeRate.value; }
                        else { twd += i.amount; krw += i.amount * exchangeRate.value; }
                    });
                    return { krw: Math.round(krw), twd: Math.round(twd) };
                });

                const sortedItinerary = computed(() => {
                    return db.value.itinerary.filter(i => i.date === selectedDate.value).sort((a,b) => (a.time||'99:99').localeCompare(b.time||'99:99'));
                });

                const refreshIcons = () => nextTick(() => { if(window.lucide) window.lucide.createIcons(); });
                const saveData = () => { localStorage.setItem(DB_KEY, JSON.stringify(db.value)); refreshIcons(); };

                const openAddModal = () => {
                    isEditing.value = false;
                    form.value = { name: '', location: '', icon: 'map-pin', time: '', amount: 0, currency: 'KRW', note: '' };
                    showModal.value = true;
                };

                const openEditModal = (item) => {
                    isEditing.value = true; editingId.value = item.id;
                    form.value = { ...item }; showModal.value = true;
                };

                const handleSave = () => {
                    if(!form.value.name) return;
                    const target = currentTab.value === 'shop' ? db.value.shop : (currentTab.value === 'cost' ? db.value.cost : db.value.itinerary);
                    if(isEditing.value) {
                        const idx = target.findIndex(i => i.id === editingId.value);
                        if(idx !== -1) target[idx] = { ...form.value, id: editingId.value };
                    } else {
                        target.push({ ...form.value, id: Date.now(), date: selectedDate.value, done: false });
                    }
                    saveData(); showModal.value = false;
                };

                const deleteItem = (type, id) => {
                    if(confirm('Á¢∫ÂÆöÂà™Èô§Ôºü')) { db.value[type] = db.value[type].filter(i => i.id !== id); saveData(); }
                };

                const openMap = (loc) => {
                    if(!loc || loc === 'TPE' || loc === 'PUS') return;
                    window.open(loc.startsWith('http') ? loc : `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(loc)}`, '_blank');
                };

                const exportData = () => {
                    navigator.clipboard.writeText(JSON.stringify(db.value, null, 2)).then(() => alert('Ë≥áÊñôÂ∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞ø'));
                };

                onMounted(() => { fetchRate(); refreshIcons(); });
                watch([currentTab, selectedDate, showModal], () => refreshIcons());

                return { 
                    currentTab, selectedDate, dates: [{id:'4/10',week:'Fri',day:'10'},{id:'4/11',week:'Sat',day:'11'},{id:'4/12',week:'Sun',day:'12'}], 
                    db, sortedItinerary, showModal, form, exportData, openAddModal, openEditModal, handleSave, deleteItem, openMap, saveData,
                    exchangeRate, totals, fetchRate
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
