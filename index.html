<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Busan Trip</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans TC', 'Inter', sans-serif; background-color: #f8fafc; margin: 0; padding: 0; touch-action: pan-y; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .header-banner { 
            width: 100%; 
            height: 350px; 
            background-image: url('image_ac77bf.jpg'); 
            background-size: cover; 
            background-position: center; 
            position: relative; 
        }
        .header-overlay { 
            position: absolute; 
            inset: 0; 
            background: linear-gradient(to top, rgba(248,250,252,1) 0%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.4) 100%); 
        }

        .main-content { margin-top: -60px; border-radius: 40px 40px 0 0; background: #f8fafc; min-height: 80vh; padding: 24px; position: relative; }
        
        .nav-container { 
            position: absolute; 
            bottom: 80px; 
            right: 24px; 
            display: flex; 
            gap: 8px; 
            background: rgba(255,255,255,0.9); 
            backdrop-filter: blur(10px); 
            padding: 6px; 
            border-radius: 22px; 
            z-index: 30;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        
        .tab-btn { transition: all 0.3s; display: flex; align-items: center; justify-content: center; width: 44px; height: 44px; border-radius: 16px; }
        .tab-btn.active { background-color: #3b82f6; color: white; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); }
        
        .date-item.active { background: #3b82f6; color: white; border-color: #3b82f6; transform: scale(1.05); }
        .time-tag { background: #eff6ff; color: #3b82f6; padding: 2px 8px; border-radius: 8px; font-family: 'Inter', monospace; font-weight: 700; font-size: 11px; }
        
        .flight-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-left: 4px solid #3b82f6;
        }
    </style>
</head>
<body>
    <div id="app" class="max-w-md mx-auto relative min-h-screen">
        
        <div class="fixed top-4 left-4 z-50">
            <button @click="exportData" class="bg-black/60 text-white text-[10px] px-4 py-2 rounded-full backdrop-blur-md flex items-center gap-2 border border-white/20 hover:bg-black/80 transition-all">
                <i data-lucide="share-2" class="w-3 h-3"></i> 同步最新資料
            </button>
        </div>

        <header class="header-banner">
            <div class="header-overlay"></div>
            <div class="absolute bottom-[140px] right-8 z-10 text-right">
                <p class="text-[12px] font-bold text-blue-500 tracking-[0.4em] uppercase mb-1">Spring 2025</p>
                <h1 class="text-5xl font-black text-slate-800 uppercase tracking-tighter">Busan Trip</h1>
            </div>
            
            <div class="nav-container">
                <button @click="currentTab = 'itinerary'" :class="['tab-btn', currentTab==='itinerary'?'active':'text-gray-400']"><i data-lucide="calendar"></i></button>
                <button @click="currentTab = 'info'" :class="['tab-btn', currentTab==='info'?'active':'text-gray-400']"><i data-lucide="plane"></i></button>
                <button @click="currentTab = 'shop'" :class="['tab-btn', currentTab==='shop'?'active':'text-gray-400']"><i data-lucide="shopping-bag"></i></button>
                <button @click="currentTab = 'cost'" :class="['tab-btn', currentTab==='cost'?'active':'text-gray-400']"><i data-lucide="wallet"></i></button>
            </div>
        </header>

        <main class="main-content pb-32">
            <div v-show="currentTab === 'itinerary'">
                <div class="flex overflow-x-auto gap-3 no-scrollbar mb-8 py-2">
                    <div v-for="d in dates" :key="d.id" @click="selectedDate = d.id" :class="['date-item flex-shrink-0 w-16 h-20 rounded-[2rem] border flex flex-col items-center justify-center cursor-pointer shadow-sm transition-all', selectedDate === d.id ? 'active' : 'bg-white text-gray-400 border-gray-100']">
                        <span class="text-[10px] font-bold uppercase mb-1">{{ d.week }}</span>
                        <span class="text-xl font-black font-mono">{{ d.day }}</span>
                    </div>
                </div>
                <div class="space-y-4">
                    <div v-for="item in sortedItinerary" :key="item.id" class="bg-white p-5 rounded-[2rem] border border-gray-50 shadow-sm flex gap-4 items-center">
                        <div class="p-4 rounded-2xl bg-blue-50 text-blue-500 shadow-inner"><i :data-lucide="item.icon || 'map-pin'" class="w-5 h-5"></i></div>
                        <div class="flex-1" @click="openEditModal(item)">
                            <div class="flex justify-between items-start">
                                <div>
                                    <span v-if="item.time" class="time-tag mb-1.5 inline-block">{{ item.time }}</span>
                                    <h3 class="font-bold text-gray-800 text-base leading-tight">{{ item.name }}</h3>
                                </div>
                                <div class="flex gap-1">
                                    <button v-if="item.location" @click.stop="openMap(item.location)" class="text-blue-500 bg-blue-50 p-2.5 rounded-full"><i data-lucide="map" class="w-4 h-4"></i></button>
                                    <button @click.stop="deleteItem('itinerary', item.id)" class="text-gray-300 p-2.5 hover:text-red-400 transition-colors"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'info'" class="space-y-6">
                <div class="flight-card p-6 rounded-[2.5rem] text-white shadow-xl relative overflow-hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-black text-lg tracking-widest flex items-center gap-2 uppercase"><i data-lucide="plane" class="w-5 h-5 text-blue-400"></i> Flight Info</h3>
                    </div>
                    <div class="space-y-6">
                        <div class="flex justify-between items-center border-b border-white/10 pb-4">
                            <div class="text-left"><p class="text-[10px] text-gray-400 font-bold uppercase">4/10 TPE</p><p class="text-2xl font-black">02:50</p></div>
                            <i data-lucide="move-right" class="w-4 h-4 text-blue-400"></i>
                            <div class="text-right"><p class="text-[10px] text-gray-400 font-bold uppercase">BUSAN PUS</p><p class="text-2xl font-black">06:10</p></div>
                        </div>
                        <div class="flex justify-between items-center">
                            <div class="text-left"><p class="text-[10px] text-gray-400 font-bold uppercase">4/12 PUS</p><p class="text-2xl font-black">20:45</p></div>
                            <i data-lucide="move-right" class="w-4 h-4 text-blue-400"></i>
                            <div class="text-right"><p class="text-[10px] text-gray-400 font-bold uppercase">TAIPEI TPE</p><p class="text-2xl font-black">22:10</p></div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'shop'" class="space-y-4">
                <div class="flex justify-between items-end mb-4">
                    <h2 class="font-black text-3xl text-gray-800">Shopping</h2>
                </div>
                <div v-for="item in db.shop" :key="item.id" class="flex items-center gap-4 bg-white p-5 rounded-3xl border border-gray-100 transition-all" :class="{'opacity-60': item.done}">
                    <input type="checkbox" v-model="item.done" @change="saveData" class="w-6 h-6 rounded-full border-2 border-blue-500 text-blue-500">
                    <p :class="{'line-through': item.done}" class="flex-1 font-bold text-gray-700 text-lg">{{ item.name }}</p>
                    <button @click="deleteItem('shop', item.id)" class="text-gray-200 hover:text-red-400"><i data-lucide="x" class="w-5 h-5"></i></button>
                </div>
            </div>

            <div v-if="currentTab === 'cost'" class="space-y-4">
                <div class="bg-slate-900 p-8 rounded-[3rem] text-white shadow-2xl">
                    <p class="text-[10px] opacity-50 font-bold uppercase tracking-[0.3em] mb-2 text-blue-400">Total Expenses</p>
                    <div class="flex justify-between items-end">
                        <p class="text-3xl font-black">₩ {{ totalKRW.toLocaleString() }}</p>
                        <p class="text-sm text-gray-400 font-bold">≈ NT$ {{ totalTWD.toLocaleString() }}</p>
                    </div>
                </div>
                <div v-for="item in db.cost" :key="item.id" class="bg-white p-5 rounded-[2rem] border border-gray-50 flex justify-between items-center">
                    <div class="flex items-center gap-4">
                        <div class="p-3 rounded-xl bg-slate-50 text-slate-400"><i data-lucide="receipt" class="w-5 h-5"></i></div>
                        <div>
                            <p class="font-bold text-gray-800">{{ item.name }}</p>
                            <p class="text-[10px] text-gray-400 uppercase font-bold">{{ item.currency }}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-black text-gray-800">{{ item.currency === 'KRW' ? '₩' : '$' }} {{ item.amount.toLocaleString() }}</p>
                        <button @click="deleteItem('cost', item.id)" class="text-xs text-red-300">刪除</button>
                    </div>
                </div>
            </div>
        </main>

        <button @click="openAddModal" class="fixed bottom-8 right-8 w-16 h-16 bg-blue-500 text-white rounded-full shadow-2xl flex items-center justify-center z-40 border-4 border-white active:scale-90 transition-transform">
            <i data-lucide="plus" class="w-8 h-8"></i>
        </button>

        <div v-if="showModal" class="fixed inset-0 z-50 bg-black/60 backdrop-blur-md flex items-end justify-center">
            <div class="bg-white w-full max-w-md rounded-t-[3.5rem] p-10 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-8">
                    <h3 class="text-2xl font-black text-gray-800">{{ modalTitle }}</h3>
                    <button @click="showModal = false" class="bg-gray-100 p-2 rounded-full text-gray-400"><i data-lucide="x"></i></button>
                </div>

                <div v-if="currentTab === 'itinerary' || currentTab === 'info'" class="space-y-6">
                    <input v-model="form.name" type="text" placeholder="項目名稱" class="w-full border-b-2 py-3 outline-none font-bold text-xl focus:border-blue-500">
                    <input v-model="form.location" type="text" placeholder="地圖連結" class="w-full border-b-2 py-3 outline-none text-blue-600">
                    <div class="flex gap-4">
                        <input v-model="form.time" type="time" class="flex-1 border-b-2 py-3 outline-none font-bold">
                        <select v-model="form.icon" class="flex-1 border-b-2 py-3 outline-none">
                            <option value="map-pin">景點</option>
                            <option value="utensils">餐飲</option>
                            <option value="shopping-cart">購物</option>
                            <option value="plane">交通</option>
                        </select>
                    </div>
                </div>

                <div v-if="currentTab === 'shop'" class="space-y-6">
                    <input v-model="shopForm.name" type="text" placeholder="想買什麼呢？" class="w-full border-b-2 py-3 outline-none font-bold text-xl focus:border-blue-500">
                </div>

                <div v-if="currentTab === 'cost'" class="space-y-6">
                    <input v-model="costForm.name" type="text" placeholder="消費內容" class="w-full border-b-2 py-3 outline-none font-bold text-xl focus:border-blue-500">
                    <div class="flex gap-4 items-end">
                        <div class="flex-1">
                            <label class="text-[10px] font-black text-gray-400 block mb-1">幣別</label>
                            <select v-model="costForm.currency" class="w-full border-b-2 py-3 outline-none font-bold">
                                <option value="KRW">KRW ₩</option>
                                <option value="TWD">TWD $</option>
                            </select>
                        </div>
                        <div class="flex-[2]">
                            <label class="text-[10px] font-black text-gray-400 block mb-1">金額</label>
                            <input v-model.number="costForm.amount" type="number" class="w-full border-b-2 py-3 outline-none font-bold text-xl">
                        </div>
                    </div>
                </div>

                <button @click="handleSave" class="w-full bg-blue-500 text-white py-5 rounded-[2rem] mt-10 font-black shadow-lg">確認儲存</button>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch, nextTick } = Vue;

        createApp({
            setup() {
                const DB_KEY = 'busan_vFinal_2025_Full_Sync';
                const currentTab = ref('itinerary');
                const selectedDate = ref('4/10');
                const showModal = ref(false);
                const isEditing = ref(false);
                const editingId = ref(null);
                
                // 表單資料結構
                const form = ref({ name: '', location: '', icon: 'map-pin', time: '' });
                const shopForm = ref({ name: '' });
                const costForm = ref({ name: '', amount: '', currency: 'KRW' });

                const db = ref(JSON.parse(localStorage.getItem(DB_KEY)) || { itinerary: [], shop: [], cost: [] });
                const dates = [{id:'4/10',week:'Fri',day:'10'},{id:'4/11',week:'Sat',day:'11'},{id:'4/12',week:'Sun',day:'12'}];
                const rate = 0.024; // 1 KRW = 0.024 TWD

                const sortedItinerary = computed(() => {
                    return db.value.itinerary.filter(i => i.date === selectedDate.value).sort((a,b) => (a.time||'99:99').localeCompare(b.time||'99:99'));
                });

                const modalTitle = computed(() => {
                    if (currentTab.value === 'shop') return '新增購物';
                    if (currentTab.value === 'cost') return '新增消費';
                    return isEditing.value ? '編輯行程' : '新增行程';
                });

                const totalKRW = computed(() => {
                    return db.value.cost.reduce((sum, item) => {
                        return sum + (item.currency === 'KRW' ? item.amount : item.amount / rate);
                    }, 0);
                });

                const totalTWD = computed(() => {
                    return db.value.cost.reduce((sum, item) => {
                        return sum + (item.currency === 'TWD' ? item.amount : item.amount * rate);
                    }, 0);
                });

                const refreshIcons = () => nextTick(() => { if(window.lucide) window.lucide.createIcons(); });
                const saveData = () => { localStorage.setItem(DB_KEY, JSON.stringify(db.value)); refreshIcons(); };

                const openAddModal = () => {
                    isEditing.value = false;
                    form.value = { name: '', location: '', icon: 'map-pin', time: '' };
                    shopForm.value = { name: '' };
                    costForm.value = { name: '', amount: '', currency: 'KRW' };
                    showModal.value = true;
                };

                const openEditModal = (item) => {
                    if (currentTab.value !== 'itinerary') return;
                    isEditing.value = true; editingId.value = item.id;
                    form.value = { ...item }; showModal.value = true;
                };

                const handleSave = () => {
                    if (currentTab.value === 'shop') {
                        if(!shopForm.value.name) return;
                        db.value.shop.push({ id: Date.now(), name: shopForm.value.name, done: false });
                    } else if (currentTab.value === 'cost') {
                        if(!costForm.value.name || !costForm.value.amount) return;
                        db.value.cost.push({ id: Date.now(), ...costForm.value });
                    } else {
                        if(!form.value.name) return;
                        if(isEditing.value) {
                            const idx = db.value.itinerary.findIndex(i => i.id === editingId.value);
                            db.value.itinerary[idx] = { ...form.value, id: editingId.value };
                        } else {
                            db.value.itinerary.push({ ...form.value, id: Date.now(), date: selectedDate.value });
                        }
                    }
                    saveData(); showModal.value = false;
                };

                const deleteItem = (type, id) => {
                    if(confirm('確定要刪除嗎？')) {
                        db.value[type] = db.value[type].filter(i => i.id !== id);
                        saveData();
                    }
                };

                const openMap = (loc) => {
                    if(!loc) return;
                    window.open(loc.startsWith('http') ? loc : `https://www.google.com/maps/search/${encodeURIComponent(loc)}`, '_blank');
                };

                const exportData = () => {
                    navigator.clipboard.writeText(JSON.stringify(db.value, null, 2)).then(() => alert('資料已複製！'));
                };

                onMounted(() => refreshIcons());
                watch([currentTab, selectedDate, showModal], () => refreshIcons());

                return { currentTab, selectedDate, dates, db, sortedItinerary, showModal, form, shopForm, costForm, modalTitle, totalKRW, totalTWD, exportData, openAddModal, openEditModal, handleSave, deleteItem, openMap, saveData };
            }
        }).mount('#app');
    </script>
</body>
</html>
