<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Busan Trip</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #fcfcfc; margin: 0; padding: 0; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .header-banner {
            width: 100%; height: 280px;
            background-image: url('image_ac77bf.jpg');
            background-size: cover; background-position: left center; position: relative;
        }
        .main-content {
            margin-top: -50px; border-radius: 40px 40px 0 0;
            background: white; min-height: 80vh; padding: 24px; position: relative;
            box-shadow: 0 -10px 20px rgba(0,0,0,0.05);
        }
        .tab-btn { transition: all 0.3s; display: flex; align-items: center; justify-content: center; width: 44px; height: 44px; }
        .tab-btn.active { background-color: #ffb7c5; color: white; border-radius: 12px; box-shadow: 0 4px 10px rgba(255, 183, 197, 0.4); }
        .date-item.active { background: #ffb7c5; color: white; border-color: #ffb7c5; }
        .modal-bg { background: rgba(0,0,0,0.4); backdrop-filter: blur(4px); }
    </style>
</head>
<body>
    <div id="app" class="max-w-md mx-auto relative overflow-x-hidden min-h-screen">
        
        <header class="header-banner">
            <div class="absolute bottom-20 left-6 text-white drop-shadow-md">
                <h1 class="text-3xl font-black tracking-tight">Busan Trip</h1>
                <p class="text-xs opacity-90 font-bold">2025 Spring Travel</p>
            </div>
            <div class="absolute bottom-16 right-4 flex gap-2 bg-white/80 backdrop-blur-md p-2 rounded-2xl shadow-lg border border-white/50">
                <button @click="currentTab = 'itinerary'" :class="['tab-btn', currentTab==='itinerary'?'active':'text-gray-400']"><i data-lucide="map-pin"></i></button>
                <button @click="currentTab = 'info'" :class="['tab-btn', currentTab==='info'?'active':'text-gray-400']"><i data-lucide="info"></i></button>
                <button @click="currentTab = 'shop'" :class="['tab-btn', currentTab==='shop'?'active':'text-gray-400']"><i data-lucide="shopping-basket"></i></button>
                <button @click="currentTab = 'cost'" :class="['tab-btn', currentTab==='cost'?'active':'text-gray-400']"><i data-lucide="wallet"></i></button>
            </div>
        </header>

        <main class="main-content pb-32">
            <div v-if="currentTab === 'itinerary'">
                <div class="flex overflow-x-auto gap-3 no-scrollbar mb-8">
                    <div v-for="d in dates" :key="d.id" @click="selectedDate = d.id"
                         :class="['date-item flex-shrink-0 w-16 h-20 rounded-3xl border flex flex-col items-center justify-center transition-all cursor-pointer', selectedDate === d.id ? 'active' : 'bg-white border-gray-100 text-gray-400']">
                        <span class="text-[10px] font-bold uppercase mb-1">{{ d.week }}</span>
                        <span class="text-xl font-bold">{{ d.day }}</span>
                    </div>
                </div>

                <div class="space-y-6">
                    <div v-for="(item, index) in filteredItinerary" :key="index" class="relative group">
                        <div class="bg-white p-4 rounded-[2rem] border border-gray-50 shadow-sm flex gap-4 items-center">
                            <div class="p-3 rounded-2xl bg-pink-50 text-pink-400">
                                <i :data-lucide="item.icon || 'map-pin'"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between">
                                    <h3 class="font-bold text-gray-800">{{ item.name }}</h3>
                                    <button @click="deleteItem('itinerary', item.id)" class="text-gray-300 hover:text-red-400"><i data-lucide="trash-2" class="w-4"></i></button>
                                </div>
                                <p class="text-[11px] text-gray-400 mt-0.5" v-if="item.time"><i data-lucide="clock" class="inline w-3 h-3 mr-1"></i>{{ item.time }}</p>
                                <p class="text-xs text-gray-500 mt-1 italic">{{ item.note }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'info'" class="space-y-6">
                <div class="bg-gradient-to-br from-indigo-500 to-purple-600 p-6 rounded-[2.5rem] text-white">
                    <h3 class="font-bold mb-4 flex items-center gap-2"><i data-lucide="refresh-cw"></i> 匯率即時算</h3>
                    <input type="number" v-model="krw" class="w-full bg-white/20 p-3 rounded-2xl border border-white/30 text-white font-bold mb-4 focus:outline-none" placeholder="輸入韓元">
                    <div class="bg-white p-4 rounded-2xl flex justify-between items-center text-indigo-600">
                        <span class="font-bold opacity-60">TWD</span>
                        <span class="text-2xl font-black">NT$ {{ (krw * 0.024).toFixed(0) }}</span>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'shop'" class="space-y-4">
                <h2 class="font-bold text-xl text-gray-800 mb-4">Shopping List</h2>
                <div v-for="(item, index) in shopList" :key="index" class="flex items-center gap-3 bg-gray-50 p-4 rounded-2xl group">
                    <input type="checkbox" v-model="item.done" @change="saveData" class="w-5 h-5 rounded-full border-pink-300 text-pink-400">
                    <div class="flex-1">
                        <p :class="['font-bold text-gray-700', item.done ? 'line-through opacity-40' : '']">{{ item.name }}</p>
                    </div>
                    <button @click="deleteItem('shop', index)" class="text-gray-300"><i data-lucide="x" class="w-4"></i></button>
                </div>
            </div>

            <div v-if="currentTab === 'cost'" class="space-y-4">
                <div class="bg-gray-800 p-6 rounded-[2rem] text-white mb-6">
                    <p class="text-xs opacity-60 uppercase font-bold tracking-widest">Total Expenses</p>
                    <p class="text-3xl font-black">₩ {{ totalCost.toLocaleString() }}</p>
                </div>
                <div v-for="(item, index) in costList" :key="index" class="flex justify-between items-center p-4 border-b border-gray-50">
                    <div>
                        <p class="font-bold text-gray-700">{{ item.name }}</p>
                        <p class="text-[10px] text-gray-400">{{ item.date }}</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="font-black text-pink-500">₩ {{ parseInt(item.amount).toLocaleString() }}</span>
                        <button @click="deleteItem('cost', index)" class="text-gray-200"><i data-lucide="trash-2" class="w-4"></i></button>
                    </div>
                </div>
            </div>
        </main>

        <button v-if="currentTab !== 'info'" @click="showModal = true" class="fixed bottom-8 right-8 w-16 h-16 bg-pink-400 text-white rounded-full shadow-2xl flex items-center justify-center active:scale-90 transition-all z-40">
            <i data-lucide="plus" class="w-8 h-8"></i>
        </button>

        <div v-if="showModal" class="fixed inset-0 z-50 modal-bg flex items-end justify-center">
            <div class="bg-white w-full max-w-md rounded-t-[3rem] p-8 animate-in slide-in-from-bottom duration-300">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800">Add to {{ currentTab.toUpperCase() }}</h3>
                    <button @click="showModal = false" class="p-2 bg-gray-100 rounded-full text-gray-400"><i data-lucide="x" class="w-5 h-5"></i></button>
                </div>
                
                <div class="space-y-5">
                    <div>
                        <label class="text-[10px] font-bold text-gray-400 uppercase">Item Name</label>
                        <input v-model="form.name" type="text" class="w-full border-b border-gray-200 py-2 focus:border-pink-300 outline-none font-bold" placeholder="e.g. 燒肉午餐">
                    </div>
                    
                    <div v-if="currentTab === 'itinerary'">
                        <label class="text-[10px] font-bold text-gray-400 uppercase">Time</label>
                        <input v-model="form.time" type="text" class="w-full border-b border-gray-200 py-2 focus:border-pink-300 outline-none" placeholder="e.g. 12:00">
                    </div>

                    <div v-if="currentTab === 'cost'">
                        <label class="text-[10px] font-bold text-gray-400 uppercase">Amount (KRW)</label>
                        <input v-model="form.amount" type="number" class="w-full border-b border-gray-200 py-2 focus:border-pink-300 outline-none font-black text-pink-500" placeholder="0">
                    </div>

                    <div v-if="currentTab === 'itinerary' || currentTab === 'shop'">
                        <label class="text-[10px] font-bold text-gray-400 uppercase">Note</label>
                        <input v-model="form.note" type="text" class="w-full border-b border-gray-200 py-2 focus:border-pink-300 outline-none text-gray-500">
                    </div>
                </div>

                <button @click="handleSave" class="w-full bg-pink-400 text-white py-4 rounded-2xl mt-8 font-bold shadow-lg shadow-pink-100">Confirm Add</button>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch, nextTick } = Vue;

        createApp({
            setup() {
                const currentTab = ref('itinerary');
                const selectedDate = ref('4/10');
                const showModal = ref(false);
                const krw = ref(10000);

                // 資料從 LocalStorage 讀取
                const itineraryData = ref(JSON.parse(localStorage.getItem('itinerary_v1')) || [
                    { id: Date.now(), date: '4/10', name: '桃園機場', category: '航班', icon: 'plane', time: '02:50', note: '釜山航空 7C6154' }
                ]);
                const shopList = ref(JSON.parse(localStorage.getItem('shop_v1')) || []);
                const costList = ref(JSON.parse(localStorage.getItem('cost_v1')) || []);

                const dates = [
                    { id: '4/10', week: 'Fri', day: '10' },
                    { id: '4/11', week: 'Sat', day: '11' },
                    { id: '4/12', week: 'Sun', day: '12' }
                ];

                const form = ref({ name: '', time: '', note: '', amount: 0 });

                const filteredItinerary = computed(() => {
                    return itineraryData.value.filter(item => item.date === selectedDate.value);
                });

                const totalCost = computed(() => {
                    return costList.value.reduce((sum, item) => sum + parseInt(item.amount || 0), 0);
                });

                const saveData = () => {
                    localStorage.setItem('itinerary_v1', JSON.stringify(itineraryData.value));
                    localStorage.setItem('shop_v1', JSON.stringify(shopList.value));
                    localStorage.setItem('cost_v1', JSON.stringify(costList.value));
                };

                const handleSave = () => {
                    if(!form.value.name) return;
                    
                    const newItem = { ...form.value, id: Date.now(), date: selectedDate.value };

                    if(currentTab.value === 'itinerary') itineraryData.value.push(newItem);
                    if(currentTab.value === 'shop') shopList.value.push({ ...newItem, done: false });
                    if(currentTab.value === 'cost') costList.value.push(newItem);

                    saveData();
                    showModal.value = false;
                    form.value = { name: '', time: '', note: '', amount: 0 };
                    nextTick(() => lucide.createIcons());
                };

                const deleteItem = (type, target) => {
                    if(type === 'itinerary') itineraryData.value = itineraryData.value.filter(i => i.id !== target);
                    if(type === 'shop') shopList.value.splice(target, 1);
                    if(type === 'cost') costList.value.splice(target, 1);
                    saveData();
                    nextTick(() => lucide.createIcons());
                };

                onMounted(() => lucide.createIcons());
                watch([currentTab, showModal, selectedDate], () => nextTick(() => lucide.createIcons()));

                return { 
                    currentTab, selectedDate, dates, filteredItinerary, krw, 
                    shopList, costList, totalCost, showModal, form, 
                    handleSave, deleteItem, saveData 
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
